# 能源管理系统简介

  能源管理系统（EMS）主要用于监控、控制和优化设备和系统的能源使用。EMS可以用于家庭、建筑、工厂、社区等多种环境中。与PCS（过程控制系统）或BMS（建筑管理系统）不同，EMS专注于能源流和消费，旨在实现能源效率、节能和成本优化。它可以整合PCS和BMS，以及其他的系统（如HVAC、照明等），从而实现更高的能源效率和优化。

   主要功能：
   - 数据采集和监控
   - 能源使用分析
   - 优化能源消耗和成本
   - 预测未来的能源需求
   - 提供节能建议和控制策略

这些系统在现代能源和电网应用中都起着关键的作用，尤其是在可再生能源、储能和智能电网的背景下。

## EMS的框架

能源管理系统（EMS）是一个非常重要的工具，旨在监测、控制和优化能源使用，从而实现节能、减排和降低成本的目标。以下是 EMS 框架中各个模块的功能和实现方式。

### 1. **用户与角色管理**

#### 功能描述：
- **用户管理**：支持用户注册、登录、权限管理和密码重置等功能。用户可以根据不同角色分配权限，如管理员、操作员、观察员等。
- **角色管理**：定义系统中的不同角色，并为每个角色分配特定的权限，确保用户只能访问其权限范围内的资源。

#### 实现方式：
- **数据库设计**：使用 PostgreSQL 存储用户信息和角色权限。每个用户记录包含用户ID、用户名、密码哈希、角色ID等字段。
- **认证与授权**：后端使用 Go-Zero 提供的认证与授权中间件，确保用户在访问敏感数据和操作前经过身份验证。
- **UI 设计**：前端使用 Vue 与 ElementPlus3 提供用户管理界面，支持用户操作的可视化管理。


### 2. **数据采集与接入**

#### 功能描述：
- **设备接入**：支持多种设备和传感器的接入，包括能源计量设备、环境传感器、智能家电等。
- **数据采集**：实时采集设备数据，如能耗数据、温湿度数据、设备状态数据等，并将其存储到数据库中。

#### 实现方式：
- **前栈使用 EdgeX Foundry**：数据接入部分主要采用 EdgeX Foundry 作为前栈。EdgeX Foundry 是一个开放的边缘计算平台，专为物联网（IoT）设备的数据采集与管理而设计。它提供了丰富的设备服务、数据路由和管理功能，适合处理各种异构设备的数据采集需求。
  - **设备服务（Device Services）**：EdgeX Foundry 通过设备服务与各类传感器和设备通信，支持多种协议，如 MQTT、Modbus、BACnet 等。
  - **数据总线**：EdgeX 使用消息总线（Message Bus）进行数据的发布与订阅，确保数据在不同服务之间的高效传递和处理。
  - **数据过滤与转换**：在数据进入核心服务之前，EdgeX 提供数据过滤与转换功能，保证数据的准确性与有效性。
- **通信协议**：虽然 EdgeX 支持多种通信协议，但在整个系统中，MQTT 是主要的协议，用于设备数据的传输与接入。EdgeX 的灵活性允许系统根据需要选择最适合的协议。
- **数据处理**：采集到的数据通过 EdgeX 传递到后端服务，后端服务使用 Julia 进行数据的预处理和初步分析，如数据清洗、异常检测等，为后续的优化与控制提供基础数据。
- **后端服务**：Go-Zero 提供数据接入的 API 服务，接收来自 EdgeX 和设备的数据，并将其存储到数据库中，供后续分析和处理使用。

通过使用 EdgeX Foundry，系统在数据接入和采集方面具备了极大的灵活性和扩展性，能够适应多种不同设备和协议，同时也提供了丰富的边缘处理能力，为 EMS 系统的高效运行奠定了基础。


### 3. **数据存储**

#### 功能描述：
- **数据管理**：存储所有采集到的实时数据、历史数据、配置数据等，支持大数据量的高效读写操作。
- **数据查询**：提供高效的数据查询接口，支持按时间范围、设备类型、地理位置等多维度查询数据。

#### 实现方式：
- **主数据库**：使用 PostgreSQL 作为主要数据库，存储结构化数据，如设备配置、用户信息、历史能耗数据等。
- **数据备份**：定期对数据库进行备份，确保数据的安全性与可恢复性。

### 4. **基础设备数据库**

#### 功能描述：
- **设备信息管理**：存储与管理所有接入设备的基础信息，如设备类型、型号、制造商、安装位置、维护记录等。
- **设备配置**：支持对设备的配置参数进行管理和调整，如阈值设置、报警设置等。

#### 实现方式：
- **设备模型**：在 PostgreSQL 中设计设备表结构，每个设备记录包含设备ID、设备类型、配置参数等信息。
- **接口实现**：Go-Zero 提供设备管理的 API 接口，支持设备信息的增删改查操作。

### 5. **天气数据库**

#### 功能描述：
- **天气数据存储**：存储实时和历史天气数据，如温度、湿度、风速、降雨量等。
- **天气数据分析**：利用天气数据进行能源需求预测和优化，如根据天气变化调整空调负荷、光伏发电预测等。

#### 实现方式：
- **数据来源**：通过集成第三方天气 API 或气象站数据源获取天气信息，并存储在 PostgreSQL 中。
- **分析模块**：使用 Julia 对天气数据进行分析与预测，支持能源管理策略的制定和优化。

## 技术栈

### 整体架构

能源管理系统（EMS）采用云原生微服务架构，设计为功能松耦合的系统，支持前后端分离和容器化部署。整个系统的架构如下：

#### 1. **前端**
   - **技术栈**：Vue.js 与 ElementPlus3
   - **功能**：用户界面、数据展示、操作交互
   - **特点**：前端通过REST API与后端进行通信，实现了与后端的完全分离，确保了灵活的用户体验和易于维护的代码结构。

#### 2. **后端**
   - **技术栈**：Go-Zero 框架
   - **功能**：处理业务逻辑、管理数据接口、执行用户请求
   - **特点**：采用微服务架构，每个服务独立部署和扩展，确保系统的高可用性和可维护性。各服务通过轻量级通信协议（如gRPC、HTTP）进行交互。

#### 3. **计算引擎**
   - **技术栈**：Julia
   - **功能**：负责复杂的计算任务，如能源优化、预测分析等
   - **特点**：通过容器化与其他服务集成，实现高效的计算能力，并能够在需要时进行横向扩展。

#### 4. **容器化与编排**
   - **平台**：K3s
   - **功能**：提供轻量级的Kubernetes集群，用于管理和编排容器化的微服务
   - **特点**：系统所有组件均以容器化方式部署，K3s提供了自动化的服务发现、负载均衡、扩展、和更新功能，确保系统的灵活性和可扩展性。

#### 5. **数据存储与管理**
   - **数据库**：使用PostgreSQL作为主要的关系型数据库，用于存储系统的配置、用户数据、实时监控数据等。
   - **数据接入**：通过MQTT协议进行设备数据接入，支持多种设备和传感器的数据采集。
   - **特点**：数据库系统与微服务紧密集成，通过ORM或其他数据访问层实现数据的高效读写。

#### 6. **服务监控与日志**
   - **监控工具**：Prometheus + Grafana
   - **日志管理**：ELK Stack（Elasticsearch, Logstash, Kibana）
   - **特点**：实时监控服务健康状况，提供日志集中管理和查询，确保系统的稳定性和快速故障排除。

在开发阶段，为了简化环境搭建和服务管理，我们使用 `docker-compose` 来编排和管理各个服务。`docker-compose` 可以帮助我们在本地快速启动、停止和管理前后端、计算引擎以及数据库等多个服务，并保证各服务之间的依赖关系。

- **一致性**：通过 `docker-compose`，所有开发人员可以在相同的环境下进行开发，避免了因环境差异而导致的问题。
- **便捷调试**：`docker-compose` 支持日志输出和实时监控，方便调试和问题排查。
- **高效开发**：通过挂载本地代码目录到容器内，实现代码的热更新，提升开发效率。

这个整体架构和开发阶段的使用方式能够确保系统在开发、测试和生产环境中的高效性、灵活性和可扩展性。

### 语言选择

能源管理系统（EMS）采用了不同的编程语言和框架，以满足系统不同部分的需求，具体选择如下：

#### 1. **后端**
   - **语言**：Go
   - **框架**：Go-Zero
   - **特点**：Go 是一门编译型语言，以其高性能和简洁的语法而著称。Go-Zero 是一个强大的微服务框架，具有丰富的内置功能，如服务发现、负载均衡、缓存、熔断等，非常适合构建高可用性和可扩展的后端服务。

#### 2. **计算引擎**
   - **语言**：Julia
   - **工具**：SciML 工具系列 + JuMP.jl
   - **特点**：Julia 是一门高性能的动态编程语言，特别适合数值计算和科学计算。SciML 工具系列（如DifferentialEquations.jl、ModelingToolkit.jl）提供了强大的微分方程求解、建模和仿真能力，而 JuMP.jl 则是一个用于优化建模的强大工具，特别适合能源优化和预测分析任务。

#### 3. **前端**
   - **语言**：JavaScript
   - **框架**：Vue.js
   - **UI库**：ElementPlus3
   - **特点**：Vue.js 是一款轻量级的前端框架，易于学习和使用，具有灵活的组件系统。ElementPlus3 是 Vue.js 的一个 UI 组件库，提供了丰富的 UI 组件，帮助快速构建现代化的、响应式的用户界面。

这些语言和工具的选择是基于其各自的优势和系统的需求，确保 EMS 能够在高效开发的同时，具备强大的计算能力和用户友好的界面。

### 数据库

能源管理系统（EMS）将主要使用 PostgreSQL 作为数据库。PostgreSQL 是一种功能强大、开源的关系型数据库管理系统，具有良好的性能和可靠性，适合处理复杂查询和事务。

#### 1. **数据库选择**
   - **主要数据库**：PostgreSQL
   - **特点**：PostgreSQL 支持标准的SQL查询语言，并提供了强大的扩展性和灵活性，能够处理复杂的查询和数据操作。此外，PostgreSQL 还具备较高的安全性和数据完整性，适合大规模、高并发的应用场景。

#### 2. **开发阶段策略**
   - **简化数据使用**：在初始开发阶段，尽量减少其他数据存储系统的使用，专注于 PostgreSQL 的集成与开发。这一策略有助于加快开发进度，避免因使用多种数据库而导致的复杂性增加。
   - **快速迭代**：通过集中使用 PostgreSQL，可以简化数据层的管理，使开发团队能够快速迭代功能，专注于核心业务逻辑的实现。

这种数据库选择和策略将有助于在开发初期保持系统的简洁性和易维护性，同时为后续的扩展和优化打下坚实的基础。

### 部署

能源管理系统（EMS）的部署方式根据开发阶段和正式上线阶段的需求有所不同，以确保开发过程的便捷性和上线后的稳定性。

#### 1. **开发阶段**
   - **部署工具**：Docker Compose
   - **特点**：在开发阶段，使用 Docker Compose 可以快速启动和管理多个服务，简化开发环境的搭建。通过编写 `docker-compose.yml` 文件，可以定义和管理前端、后端、数据库和计算引擎等服务的容器化配置，确保开发人员在一致的环境中进行工作，减少环境差异导致的问题。

#### 2. **正式上线**
   - **部署工具**：Docker Compose 或 Kubernetes (K3s)
   - **特点**：
     - **Docker Compose**：适用于小规模的部署场景，配置简单，易于维护。对于不需要大规模扩展的系统，可以继续使用 Docker Compose 来进行生产部署。
     - **Kubernetes (K3s)**：适用于更大规模、更复杂的生产环境，提供更强大的容器编排和管理能力。K3s 是 Kubernetes 的轻量级版本，适合资源有限的环境，并且具备 Kubernetes 的核心功能，如自动扩展、负载均衡、服务发现等，能够满足生产环境下的高可用性和弹性需求。

这种部署策略允许系统在开发和生产环境中都能够保持高效和灵活性，同时为系统的扩展和优化提供了足够的空间。